{"filter":false,"title":"watcher-server.js","tooltip":"/watcher-server.js","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":42,"column":0},"action":"insert","lines":["var fs = require('fs');","var url = require('url');","var http = require('http');","var path = require('path');","var express = require('express');","var app = express();","var server = http.createServer(app);","var io = require('socket.io').listen(server);","var root = __dirname;","","app.use(function (req, res, next) {","  var file = url.parse(req.url).pathname;","  var mode = 'stylesheet';","  if (file[file.length - 1] == '/') {","    file += 'index.html';","    mode = 'reload';","  }","  createWatcher(file, mode);","  next();","});","","app.use(express.static(root));","","var watchers = {};","","function createWatcher (file, event) {","  var absolute = path.join(root, file);","","  if (watchers[absolute]) {","    return;","  }","","  fs.watchFile(absolute, function (curr, prev) {","    if (curr.mtime !== prev.mtime) {","      io.sockets.emit(event, file);","    }","  });","","  watchers[absolute] = true;","}","","server.listen(8080);",""],"id":1}]]},"ace":{"folds":[],"scrolltop":176,"scrollleft":0,"selection":{"start":{"row":42,"column":0},"end":{"row":42,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":11,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1453547587717,"hash":"035091f9e6c9230eec443287ccef6e4e8bc972bf"}